<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.com.xuct.group.purchase.mapper.UserMapper">


    <select id="userSum" resultType="cn.com.xuct.group.purchase.vo.result.UserSumResult">
        select s.id,
               sum(s.integral)           as integralCount,
               ifnull(c.collectCount, 0) as collectCount,
               ifnull(b.browseCount, 0)  as browseCount,
               ifnull(co.couponCount, 0) as couponCount
        from sys_user s
                 left join (select user_id, count(good_id) as collectCount from bu_good_user_collect group by user_id) c
                           on s.id = c.user_id
                 left join (select user_id, count(good_id) as browseCount from bu_user_browse group by user_id) b
                           on s.id = b.user_id
                 left join (select user_id, count(coupon_id) as couponCount from bu_user_coupon group by user_id) co
                           on s.id = co.user_id
            where s.id = #{userId}
        group by s.id

    </select>
</mapper>